# o11y-kit

–ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, PostgreSQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, Prometheus, Alertmanager –∏ Grafana.

## üöÄ –°–µ—Ä–≤–∏—Å—ã –∏ –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| **FastAPI** | 8000 | –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **PostgreSQL** | 5432 | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **Prometheus** | 9090 | –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ |
| **Alertmanager** | 9093 | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–∞–º–∏ |
| **Grafana** | 3000 | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–∞—à–±–æ—Ä–¥—ã |
| **PostgreSQL Exporter** | 9187 | –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –ë–î |

## üìã API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã FastAPI

| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| `GET` | `/docs` | Swagger UI |
| `GET` | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| `GET` | `/metrics` | –ú–µ—Ç—Ä–∏–∫–∏ Prometheus |
| `GET` | `/items` | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã |
| `POST` | `/items` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç |
| `GET` | `/items/{item_id}` | –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –ø–æ ID |
| `DELETE` | `/items/{item_id}` | –£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç |
| `GET` | `/loadtest` | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| `GET` | `/start-loadtest` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `GET` | `/stop-loadtest` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

#### –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞
```bash
curl -X POST "http://localhost:8000/items" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–¢–µ—Å—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç",
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞"
  }'
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
```bash
curl -X GET "http://localhost:8000/items"
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ ID
```bash
curl -X GET "http://localhost:8000/items/1"
```

#### –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞
```bash
curl -X DELETE "http://localhost:8000/items/1"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
curl -X GET "http://localhost:8000/health"
```

#### –ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
curl -X GET "http://localhost:8000/start-loadtest?rps=10"
```

#### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
curl -X GET "http://localhost:8000/stop-loadtest"
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```bash
git clone 
cd 
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .env
```bash
POSTGRES_USER=your_db_user
POSTGRES_PASSWORD=your_db_password
POSTGRES_DB=your_db_name
POSTGRES_HOST=db
POSTGRES_PORT=5432
TELEGRAM_BOT_TOKEN=7777777777:AAAAAAAAAAA-e2o_999999999AAAAAAAAA
TELEGRAM_CHAT_ID=-10000000000000
```

### 3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `monitoring/alertmanager/alertmanager.yml`
–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è
```bash
- bot_token: '7777777777:AAAAAAAAAAA-e2o_999999999AAAAAAAAA'
  chat_id: -10000000000000
```

### 3. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
docker compose up --build -d
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ì—Ä–∞—Ñ–∏–∫–∏

### –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

- **FastAPI**: http://localhost:8000
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)
- **Alertmanager**: http://localhost:9093

### Grafana –î–∞—à–±–æ—Ä–¥—ã

1. **–í—Ö–æ–¥ –≤ Grafana**:
   - URL: http://localhost:3000
   - –õ–æ–≥–∏–Ω: `admin`
   - –ü–∞—Ä–æ–ª—å: `admin`

2. **–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã**:
   - **FastAPI Dashboard**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - **PostgreSQL Dashboard**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üõ† –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

`http://localhost:8000/loadtest`

–ù–∞–≥—Ä—É–∑–∫–∞ –∏–¥—ë—Ç `GET` –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ —Ä—É—á–∫—É `/items`

- –í–≤–µ—Å—Ç–∏ –∂–µ–ª–∞–µ–º—ã–π RPS
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É `Start Test`
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç –ø–æ –∂–µ–ª–∞–Ω–∏—é

## üö® –ê–ª–µ—Ä—Ç—ã –≤ Telegram

–ê–ª–µ—Ä—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram-–∫–∞–Ω–∞–ª [@AlertsKIT](https://t.me/AlertsKIT) –∫–æ–≥–¥–∞ RPS –Ω–∞ /items –ø—Ä–µ–≤—ã—à–∞–µ—Ç 100 –≤ —Ç–µ—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–Ω—É—Ç—ã

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
o11y-kit/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ app/                    # –ö–æ–¥ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ main.py             # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îî‚îÄ‚îÄ database.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ monitoring/
‚îÇ   ‚îú‚îÄ‚îÄ prometheus/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus.yml      # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ alerts.yml          # –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ alertmanager/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alertmanager
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ alertmanager.yml    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ grafana/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Grafana
‚îÇ       ‚îú‚îÄ‚îÄ dashboards/         # –î–∞—à–±–æ—Ä–¥—ã
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ fastapi-dashboard.json
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ postgres_dashboard.json
‚îÇ       ‚îî‚îÄ‚îÄ provisioning/       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îÇ           ‚îú‚îÄ‚îÄ dashboards/
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ fastapi-dashboard.yaml
‚îÇ           ‚îî‚îÄ‚îÄ datasources/
‚îÇ               ‚îî‚îÄ‚îÄ datasource.yml
‚îú‚îÄ‚îÄ docker-compose.yml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
‚îú‚îÄ‚îÄ Dockerfile                  # Dockerfile –¥–ª—è FastAPI
‚îú‚îÄ‚îÄ requirements.txt            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env                       # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```
